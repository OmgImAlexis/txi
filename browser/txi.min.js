(function(){var e,s;if(typeof module!=="undefined"){e=require("node-fetch");s=require("xmldom").DOMParser}const t=e=>{const s=typeof e;if(e&&s==="object"){return Object.keys(e).reduce((s,i)=>{s[i]=t(e[i]);return s},{})}return e},i=(e,s)=>e.replace(new RegExp(`[^A-Za-z0-9\\s${s?":":""}]`,"g"),"").replace(/  +/g," ").toLowerCase().split(" "),r=(e,s)=>{const t=[];if(s){const s=Object.values(e).reduce((e,s)=>e[e.length-1]===s?e:e+=s,"");if(s!==e){e=s;t.push(s)}}if(e.includes("ie"))t.push(e.replace(/ie/g,"ei"));if(e.includes("ei"))t.push(e.replace(/ei/g,"ie"));if(e.includes("ea")&&!e[0]==="e"&&!e[e.length-1]==="a")t.push(e.replace(/ea/g,"e"));if(e.includes("sc")&&!e[0]==="s"&&!e[e.length-1]==="c")t.push(e.replace(/sc/g,"c"));if(e.includes("os")&&!e[0]==="o"&&!e[e.length-1]==="s")t.push(e.replace(/os/g,"ous"));if(e.endsWith("ery"))t.push(e.substring(0,e.length-3)+"ary");if(e.includes("ite"))t.push(e.replace(/ite/g,"ate"));if(e.endsWith("ent"))t.push(e.substring(0,e.length-3)+"ant");if(e.endsWith("eur"))t.push(e.substring(0,e.length-3)+"er");if(e.endsWith("for"))t.push(e+"e");if(e.startsWith("gua"))t.push("gau"+e.substring(4));if(e.endsWith("oah"))t.push(e.substring(0,e.length-3)+"aoh");if(e.endsWith("ally"))t.push(e.substring(0,e.length-4)+"ly");if(e.endsWith("ence"))t.push(e.substring(0,e.length-4)+"ance");if(e.endsWith("fore"))t.push(e.substring(0,e.length-1));if(e.endsWith("ious"))t.push(e.substring(0,e.length-4)+"ous");if(e.endsWith("guese"))t.push(e.substring(0,e.length-4)+"gese");if(e.endsWith("ible"))t.push(e.substring(0,e.length-4)+"able");if(e.startsWith("busi"))t.push("buis"+e.substring(5));if(e.startsWith("fore"))t.push("for"+e.substring(5));if(e.startsWith("fluor"))t.push("flor"+e.substring(5));if(e.startsWith("propa"))t.push("propo"+e.substring(5));return t},n=e=>e.replace(/[AEIOUaeiou]+/g,""),o=e=>Object.values(n(e)).reduce((e,s)=>e[e.length-1]===s?e:e+=s,"");_trigrams=(e=>{const s=[],t=Array.isArray(e)?e.join(""):e+"";for(let e=0;e<t.length-2;e++){s.push(t.substring(e,e+3))}return s});var a="y".charCodeAt(0);var c={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"};var u={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""};var l="[^aeiou]";var h="[aeiouy]";var f="("+l+"[^aeiouy]*)";var g="("+h+"[aeiou]*)";var m=new RegExp("^"+f+"?"+g+f);var p=new RegExp("^"+f+"?"+g+f+g+"?$");var d=new RegExp("^"+f+"?"+"("+g+f+"){2,}");var b=new RegExp("^"+f+"?"+h);var v=new RegExp("^"+f+h+"[^aeiouwxy]$");var y=/ll$/;var w=/^(.+?)e$/;var j=/^(.+?)y$/;var x=/^(.+?(s|t))(ion)$/;var O=/^(.+?)(ed|ing)$/;var E=/(at|bl|iz)$/;var W=/^(.+?)eed$/;var $=/^.+?[^s]s$/;var k=/^.+?(ss|i)es$/;var z=/([^aeiouylsz])\1$/;var R=new RegExp("^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|"+"ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|"+"biliti|logi)$");var A=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/;var C=new RegExp("^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|"+"iti|ous|ive|ize)$");function S(e){var s;var t;e=String(e).toLowerCase();if(e.length<3){return e}if(e.charCodeAt(0)===a){s=true;e="Y"+e.substr(1)}if(k.test(e)){e=e.substr(0,e.length-2)}else if($.test(e)){e=e.substr(0,e.length-1)}if(t=W.exec(e)){if(m.test(t[1])){e=e.substr(0,e.length-1)}}else if((t=O.exec(e))&&b.test(t[1])){e=t[1];if(E.test(e)){e+="e"}else if(z.test(e)){e=e.substr(0,e.length-1)}else if(v.test(e)){e+="e"}}if((t=j.exec(e))&&b.test(t[1])){e=t[1]+"i"}if((t=R.exec(e))&&m.test(t[1])){e=t[1]+c[t[2]]}if((t=A.exec(e))&&m.test(t[1])){e=t[1]+u[t[2]]}if(t=C.exec(e)){if(d.test(t[1])){e=t[1]}}else if((t=x.exec(e))&&d.test(t[1])){e=t[1]}if((t=w.exec(e))&&(d.test(t[1])||p.test(t[1])&&!v.test(t[1]))){e=t[1]}if(y.test(e)&&d.test(e)){e=e.substr(0,e.length-1)}if(s){e="y"+e.substr(1)}return e}var I=["a","about","after","ala","all","also","am","an","and","another","any","are","around","as","at","be","because","been","before","being","between","both","but","by","came","can","come","could","did","do","each","for","from","get","got","has","had","he","have","her","here","him","himself","his","how","i","if","iff","in","include","into","is","it","like","make","many","me","might","more","most","much","must","my","never","now","of","on","only","or","other","our","out","over","said","same","see","should","since","some","still","such","take","than","that","the","their","them","then","there","these","they","this","those","through","to","too","under","up","very","was","way","we","well","were","what","where","which","while","who","with","would","you","your"];function _(e,s=new Set){if(e&&typeof e==="object"&&!s.has(e)){s.add(e);return Object.keys(e).reduce((t,i)=>t+=i+": "+_(e[i],s),"")}return e}function q(e){try{return JSON.parse(e)}catch(s){return e}}function K({stops:e,stems:s=true,trigrams:n=true,compressions:a=true,misspellings:c=true}={}){const u={stops:e,stems:s,trigrams:n,compressions:a,misspellings:c};if(!this||!(this instanceof K)){return new K(u)}e=(u.stops||I).reduce((e,s)=>{e[s]=true;return e},{});const l={};let h=0,f={};this.addStops=((...s)=>{s.forEach(s=>e[s]=true);return this});this.compress=(()=>{const e=this.onchange||(()=>{});Object.keys(f).forEach(s=>{const t=f[s],i=Object.keys(t);let r;i.forEach(e=>{if(t[e].stems===0&&t[e].trigrams===0&&t[e].compressions===0){delete t[e];r=true}});if(Object.keys(t).length===0){delete f[s];delete l[s];e({[s]:null});h--}else if(r){e([s],t)}});return this});this.removeStops=((...s)=>{s.forEach(s=>delete e[s]);return this});this.remove=((...e)=>{const s=this.onchange||(()=>{});e.forEach(e=>Object.keys(f).forEach(t=>{if(f[t][e]){delete f[t][e];s({[t]:{[e]:{stems:0,trigrams:0,compressions:0}}})}}));return this});this.getIndex=(()=>t(f));this.getKeys=(()=>l);this.getKeyCount=(()=>h);this.setIndex=(e=>{f=t(e);h=0;Object.assign(l,Object.keys(f).reduce((e,s)=>{e[s]=true;h++;return e},{}));return this});this.onchange=u.onchange;this.index=function(s,t,{stems:n=u.stems,trigrams:a=u.trigrams,compressions:c=u.compressions,misspellings:g=u.misspellings}=u){const m=typeof t;if(!t||!(m==="string"||m==="object")){return}if(m==="object"){n=true}const p=t?i(_(t),m==="object"):[],d=(n||m==="object"?p.map(e=>S(e)):p).filter(s=>!e[s]),b=d.filter(e=>e[e.length-1]!==":"),v=a?_trigrams(b):[],y=(g?b.reduce((e,s)=>e.concat(r(s,true)),[]):[]).filter(e=>!v.includes(e)),w=c?b.reduce((e,s)=>e.concat(o(s)),[]).concat(y.reduce((e,s)=>e.concat(o(s)),[])):[],j=this.onchange||(()=>{});let x,O=0;d.concat(y).concat(w).forEach(t=>{if(!e[t]){let e=f[t],i;if(n&&(d.includes(t)||y.includes(t))){if(!e){e=f[t]={};l[t]=true;O++}if(!e[s]){e[s]={stems:0,trigrams:0,compressions:0}}e[s].stems++;i=e[s]}if(c&&w.includes(t)){if(!e){e=f[t]={};l[t]=true;O++}if(!e[s]){e[s]={stems:0,trigrams:0,compressions:0}}e[s].compressions++;i=e[s]}if(!x){x={}}if(!x[t]){x[t]={}}x[t][s]=i}});v.forEach(t=>{if(!e[t]){let e=f[t];if(!e){e=f[t]={};l[t]=true;O++}if(!e[s]){e[s]={stems:0,trigrams:0,compressions:0}}e[s].trigrams++;if(!x){x={}}if(!x[t]){x[t]={}}x[t][s]=e[s]}});if(x)j(x);h+=O;return this};this.search=function(s,{stems:t=u.stems,trigrams:r=u.trigrams,compressions:n=u.compressions,misspellings:a=u.misspellings}=u){const c=typeof s;if(!s||!(c==="string"||c==="object")){return[]}if(c==="object"){t=true}const l=s?i(_(s),c==="object"):[],h=(t||c==="object"?l.map(e=>S(e)):l).filter(s=>!e[s]),g=h.filter(e=>e[e.length-1]!==":"),m=r?_trigrams(g):[],p=n?g.map(e=>o(e)):[];results=h.concat(m).concat(p).reduce((s,i)=>{if(!e[i]){const e=f[i];if(e){Object.keys(e).forEach(o=>{if(!s[o]){s[o]={score:0,count:0,stems:{},trigrams:{},compressions:{}}}let a=0;if(t&&h.includes(i)){if(!s[o].stems[i]){s[o].stems[i]=0}s[o].stems[i]+=e[o].stems;s[o].score+=e[o].stems;a=1}if(r&&m.includes(i)){if(!s[o].trigrams[i]){s[o].trigrams[i]=0}const t=e[o].trigrams*.5;s[o].trigrams[i]+=t;s[o].score+=t}if(n&&p.includes(i)){if(!s[o].compressions[i]){s[o].compressions[i]=0}const t=e[o].compressions*.75;s[o].compressions[i]+=t;s[o].score+=t;a||(a=1)}s[o].count+=a})}}return s},{});const d=c==="object"?Object.keys(s):[];return Object.keys(results).reduce((e,s)=>{const t=results[s];if(t.score>0){if(c==="object"){if(d.some(e=>t.stems[e+":"])&&Object.keys(t.stems).some(e=>!d.includes(e.substring(0,e.length-1)))){e.push(Object.assign({id:q(s)},t))}}else{e.push(Object.assign({id:q(s)},t))}}return e},[]).sort((e,s)=>s.score-e.score)}}if(typeof module!=="undefined")module.exports=K;if(typeof window!=="undefined")window.Txi=K}).call(this);